# Story 4.2: Integration Monitoring Dashboard

<!-- Powered by BMADâ„¢ Core -->

## Status
Draft

## Story
**As an** Admin,
**I want** to see integration status and webhook logs in a monitoring dashboard,
**so that** I can quickly identify issues, monitor webhook health, and troubleshoot failed requests without accessing server logs.

## Acceptance Criteria

1. Dashboard page created at `/settings/integrations` showing N8N webhook status
2. Display webhook health metrics: success rate (%), average response time (ms), total requests
3. Show recent webhook requests log table (last 100 requests) with columns:
   - Timestamp
   - Status (success/error with color coding)
   - Response time
   - Job ID created (link to job detail)
   - Customer name
4. Filter logs by status (all, success, error) and date range (today, last 7 days, last 30 days, custom)
5. View detailed request/response payload in modal for each log entry (for debugging)
6. Manual webhook health check button that tests endpoint connectivity
7. Display last successful webhook sync timestamp
8. Show error rate chart (line chart for last 24 hours, 7 days, and 30 days views)
9. Admin-only access with role-based authorization (redirect non-admin to dashboard)
10. Export webhook logs to CSV for offline analysis (last 1000 records max)

## Tasks / Subtasks

- [ ] Create monitoring dashboard page (AC: 1, 9)
  - [ ] Create /settings/integrations page with Admin authorization
  - [ ] Design layout with metrics cards at top, logs table below
  - [ ] Add navigation link in settings sidebar

- [ ] Build health metrics display (AC: 2, 7)
  - [ ] Create API endpoint GET /api/integrations/metrics
  - [ ] Calculate success rate from WebhookLog
  - [ ] Calculate average response time
  - [ ] Show total requests count
  - [ ] Display last successful sync timestamp
  - [ ] Use shadcn/ui Card components for metrics display

- [ ] Implement webhook logs table (AC: 3, 4)
  - [ ] Create API endpoint GET /api/integrations/webhook-logs with pagination
  - [ ] Add filters: status (success/error), date range
  - [ ] Build logs table component with shadcn/ui Table
  - [ ] Color code success (green) and error (red) status
  - [ ] Link job ID to job detail page
  - [ ] Implement pagination (10/25/50/100 per page)

- [ ] Add payload viewer modal (AC: 5)
  - [ ] Create PayloadViewerDialog component
  - [ ] Display formatted JSON for request payload
  - [ ] Display formatted JSON for response payload
  - [ ] Syntax highlighting for JSON (react-json-view or similar)
  - [ ] Copy to clipboard button

- [ ] Build error rate chart (AC: 8)
  - [ ] Create API endpoint GET /api/integrations/error-rate
  - [ ] Aggregate error counts by hour/day
  - [ ] Use Recharts LineChart component
  - [ ] Toggle between 24h, 7d, 30d views

- [ ] Implement health check button (AC: 6)
  - [ ] Add "Test Webhook" button
  - [ ] Create test endpoint POST /api/integrations/health-check
  - [ ] Show loading state during check
  - [ ] Display result (success/error) with toast notification

- [ ] Add CSV export functionality (AC: 10)
  - [ ] Create export button
  - [ ] Generate CSV from webhook logs
  - [ ] Download file with timestamp in filename
  - [ ] Limit to last 1000 records

- [ ] Add comprehensive testing
  - [ ] Component tests for dashboard page
  - [ ] API tests for metrics and logs endpoints
  - [ ] Test filters and pagination
  - [ ] Test health check functionality
  - [ ] E2E test for full monitoring workflow

## Dev Notes

**Quick Reference:**
- Use WebhookLog model from Story 4.1
- API endpoints return paginated results
- Charts update on interval (optional real-time with polling)
- Admin-only access enforced by middleware

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-30 | 1.0 | Initial story creation for integration monitoring | Sarah (Product Owner) |

## Dev Agent Record

(To be filled by Dev Agent during implementation)

## QA Results

(To be filled by QA Agent after implementation review)