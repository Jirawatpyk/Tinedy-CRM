// Quick Seed Script for Development
// Generated by Database Agent (Alex)

const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

// Minimal seed data for quick development setup
async function quickSeed() {
  console.log('ðŸš€ Running quick seed for development...\n');

  try {
    // Clean existing data
    await cleanData();

    // Create essential data only
    const admin = await createAdminUser();
    const operationsUser = await createOperationsUser();
    const sampleCustomers = await createSampleCustomers();
    const basicChecklist = await createBasicChecklist();
    const sampleJobs = await createSampleJobs(sampleCustomers, [admin, operationsUser]);

    console.log('\nâœ… Quick seed completed!');
    console.log('ðŸ“Š Created:');
    console.log(`  ðŸ‘¥ Users: 2`);
    console.log(`  ðŸ¢ Customers: ${sampleCustomers.length}`);
    console.log(`  ðŸ“‹ Checklists: 1`);
    console.log(`  ðŸ’¼ Jobs: ${sampleJobs.length}`);
    console.log('\nðŸ”‘ Login credentials:');
    console.log('  Admin: admin@tinedy.com');
    console.log('  Operations: operations@tinedy.com');

  } catch (error) {
    console.error('âŒ Quick seed failed:', error);
    throw error;
  }
}

async function cleanData() {
  console.log('ðŸ§¹ Cleaning existing data...');

  await prisma.auditLog.deleteMany();
  await prisma.webhookLog.deleteMany();
  await prisma.trainingWorkflow.deleteMany();
  await prisma.qualityCheck.deleteMany();
  await prisma.job.deleteMany();
  await prisma.qualityChecklist.deleteMany();
  await prisma.customer.deleteMany();
  await prisma.user.deleteMany();

  console.log('âœ… Data cleaned');
}

async function createAdminUser() {
  console.log('ðŸ‘¤ Creating admin user...');

  return await prisma.user.create({
    data: {
      id: 'admin-seed',
      email: 'admin@tinedy.com',
      name: 'à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š',
      role: 'ADMIN',
      isActive: true
    }
  });
}

async function createOperationsUser() {
  console.log('ðŸ‘¤ Creating operations user...');

  return await prisma.user.create({
    data: {
      id: 'ops-seed',
      email: 'operations@tinedy.com',
      name: 'à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£',
      role: 'OPERATIONS',
      isActive: true
    }
  });
}

async function createSampleCustomers() {
  console.log('ðŸ¢ Creating sample customers...');

  const customers = [];

  // Active customer
  customers.push(await prisma.customer.create({
    data: {
      id: 'customer-active',
      lineUserId: 'U1234567890abcdef',
      name: 'à¸šà¸£à¸´à¸©à¸±à¸— à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µ à¸­à¸´à¸™à¹‚à¸™à¹€à¸§à¸Šà¸±à¹ˆà¸™ à¸ˆà¸³à¸à¸±à¸”',
      phone: '+66-2-123-4567',
      email: 'contact@tech-innovation.com',
      address: '123 à¸–à¸™à¸™à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¯ 10110',
      status: 'ACTIVE'
    }
  }));

  // Another active customer
  customers.push(await prisma.customer.create({
    data: {
      id: 'customer-active-2',
      lineUserId: 'U0987654321fedcba',
      name: 'à¸«à¹‰à¸²à¸‡à¸«à¸¸à¹‰à¸™à¸ªà¹ˆà¸§à¸™ à¸ªà¸¡à¸²à¸£à¹Œà¸— à¹‚à¸‹à¸¥à¸¹à¸Šà¸±à¹ˆà¸™',
      phone: '+66-2-987-6543',
      email: 'info@smart-solution.co.th',
      address: '456 à¸–à¸™à¸™à¸žà¸«à¸¥à¹‚à¸¢à¸˜à¸´à¸™ à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¯ 10400',
      status: 'ACTIVE'
    }
  }));

  return customers;
}

async function createBasicChecklist() {
  console.log('ðŸ“‹ Creating basic checklist...');

  return await prisma.qualityChecklist.create({
    data: {
      id: 'checklist-basic',
      name: 'à¸¡à¸²à¸•à¸£à¸à¸²à¸™à¸à¸²à¸£à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£à¸žà¸·à¹‰à¸™à¸à¸²à¸™',
      description: 'à¹€à¸Šà¹‡à¸„à¸¥à¸´à¸ªà¸•à¹Œà¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£à¸—à¸¸à¸à¸›à¸£à¸°à¹€à¸ à¸—',
      items: [
        { item: 'à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸¹à¸à¸„à¹‰à¸²', required: true },
        { item: 'à¸¢à¸·à¸™à¸¢à¸±à¸™à¸„à¸§à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²', required: true },
        { item: 'à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£à¸•à¸²à¸¡à¸¡à¸²à¸•à¸£à¸à¸²à¸™', required: true },
        { item: 'à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸žà¸¶à¸‡à¸žà¸­à¹ƒà¸ˆà¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²', required: true },
        { item: 'à¸ˆà¸±à¸”à¸—à¸³à¹€à¸­à¸à¸ªà¸²à¸£à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£', required: false }
      ],
      isActive: true
    }
  });
}

async function createSampleJobs(customers, users) {
  console.log('ðŸ’¼ Creating sample jobs...');

  const jobs = [];

  // New job
  jobs.push(await prisma.job.create({
    data: {
      id: 'job-new',
      customerId: customers[0].id,
      serviceType: 'à¸à¸²à¸£à¸›à¸£à¸¶à¸à¸©à¸²à¸£à¸°à¸šà¸š IT',
      description: 'à¸›à¸£à¸¶à¸à¸©à¸²à¸à¸²à¸£à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡à¸£à¸°à¸šà¸šà¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸‡à¸„à¹Œà¸à¸£',
      status: 'NEW',
      priority: 'HIGH',
      scheduledAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days from now
      n8nWorkflowId: 'workflow-123'
    }
  }));

  // In progress job
  jobs.push(await prisma.job.create({
    data: {
      id: 'job-progress',
      customerId: customers[1].id,
      assignedToId: users[1].id, // Operations user
      serviceType: 'à¸à¸²à¸£à¸à¸¶à¸à¸­à¸šà¸£à¸¡à¸žà¸™à¸±à¸à¸‡à¸²à¸™',
      description: 'à¸­à¸šà¸£à¸¡à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸°à¸šà¸šà¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¸¸à¸“à¸ à¸²à¸ž',
      status: 'IN_PROGRESS',
      priority: 'MEDIUM',
      scheduledAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago
      n8nWorkflowId: 'workflow-124'
    }
  }));

  // Completed job
  jobs.push(await prisma.job.create({
    data: {
      id: 'job-completed',
      customerId: customers[0].id,
      assignedToId: users[1].id, // Operations user
      serviceType: 'à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸„à¸¸à¸“à¸ à¸²à¸ž',
      description: 'à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸£à¸°à¸šà¸šà¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¸¸à¸“à¸ à¸²à¸žà¸‚à¸­à¸‡à¸­à¸‡à¸„à¹Œà¸à¸£',
      status: 'COMPLETED',
      priority: 'MEDIUM',
      scheduledAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5 days ago
      completedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000), // 1 day ago
      n8nWorkflowId: 'workflow-125'
    }
  }));

  return jobs;
}

// Run quick seed if script is executed directly
if (require.main === module) {
  quickSeed()
    .catch((e) => {
      console.error('Quick seed failed:', e);
      process.exit(1);
    })
    .finally(async () => {
      await prisma.$disconnect();
    });
}

module.exports = quickSeed;